<html>
    <head>
        <title>Josh's blog wiki thing</title>
        <link href="../theme/main.css" type="text/css" rel="stylesheet">
    </head>
    <body>
        <header>
            <a href="/topics/">Topics</a>
        </header>

        <div class="note"><div class="note-content"><ul>
<li>
<p>need to rebase a branch which has got heaps of divergence</p>
</li>
<li>
<p>not only that, but the history has been pretty mangled over time</p>
</li>
<li>
<p>i&#x27;ve tried doing a <code>git rebase</code> and it was extremely confusing. And after about an hour it still didn&#x27;t seem to be getting any closer.</p>
</li>
<li>
<p>so new approach is: create a new branch from master, and just bring across the changes from the old branch</p>
</li>
<li>
<p>don&#x27;t want to do a straight diff because that will also show a lot of the changes in master since we started the new branch</p>
</li>
<li>
<p>instead, I&#x27;m going to try to get a diff between the branch and <em>master at the point the branch was created</em>.</p>
</li>
<li>
<p><a href="http://stackoverflow.com/questions/15954631/git-changes-to-branch-since-created">http://stackoverflow.com/questions/15954631/git-changes-to-branch-since-created</a></p>
</li>
</ul>
<ul>
<li>using this I can get a list of modified files:</li>
</ul>
<pre><code>base=$(git merge-base master HEAD)
git diff --name-only $base HEAD
</code></pre>
<ul>
<li>and with this I can get a list of just the files that were added:</li>
</ul>
<pre><code>git diff --name-status $base HEAD | grep &#x27;^A&#x27; | awk &#x27;{print $2}&#x27;
</code></pre>
<ul>
<li>put all together:</li>
</ul>
<pre><code># get the list of added files
files=$(git diff --name-status $base HEAD | grep &#x27;^A&#x27; | awk &#x27;{print $2}&#x27;)

# ensure the directories exist
echo $files | xargs -n1 dirname | xargs -I {} mkdir -p ../bugwolf/{}

# copy the files
echo $files | xargs -n1 -I {} cp ./{} ../bugwolf/{}
</code></pre>
<ul>
<li>delete removed files:</li>
</ul>
<pre><code>git diff --name-status $base HEAD | grep &#x27;^D&#x27; | awk &#x27;{print $2}&#x27; | xargs -I {} rm ../bugwolf/{}
</code></pre>
<ul>
<li>and that just leaves me with the modified files, so I need to see changes in both branches and then work out which ones to keep</li>
</ul>
</div></div>

        <footer>
            <a href="https://twitter.com/joshwnj">get in touch</a>
        </footer>
</html>
